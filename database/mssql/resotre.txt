-设置数据库为单用户模式
USE MASTER
GO
ALTER DATABASE eol_tcgroup SET SINGLE_USER WITH ROLLBACK IMMEDIATE;   
GO




---设置数据库为多用户模式
USE MASTER
GO
ALTER DATABASE eol_tcgroup SET MULTI_USER WITH ROLLBACK IMMEDIATE;   
GO



use master
go
---声明变量
declare @dbName nvarchar(max)='Mvc_HNHZ';
declare @dbFullName nvarchar(max)='E:\NewWork\Web\backup\test1.bak';
--1.1修改为单用模式
 exec(N'ALTER DATABASE '+@dbName+' SET SINGLE_USER WITH ROLLBACK IMMEDIATE');
--1.2结束链接进程
	DECLARE @kid varchar(max)  
	SET @kid=''  
	SELECT @kid=@kid+'KILL '+CAST(spid as Varchar(10))  FROM master..sysprocesses  
	WHERE dbid=DB_ID(@dbName)  ;
	EXEC(@kid) ;
--2.执行还原语句
   restore database @dbName from  disk=@dbFullName
   with replace  --覆盖现有的数据库
--3.重置数据库为多用户模式
 exec(N'ALTER DATABASE '+@dbName+' SET MULTI_USER WITH ROLLBACK IMMEDIATE');
 
 
 方案2
 
 
 ALTER DATABASE [Macrowing.Organization]  SET OFFLINE WITH ROLLBACK IMMEDIATE
go
declare @filename varchar(50);
declare @datetime varchar(50);
declare @database varchar(400);
set @datetime =  convert(varchar(6),getdate(),112);
set @database='Macrowing.Organization'
set @filename='e:\212\'+@datetime+'_'+@database+'.bak'
print @filename


RESTORE DATABASE [Macrowing.Organization] FROM DISK=@filename with replace
go

ALTER database [Macrowing.Organization] set online
